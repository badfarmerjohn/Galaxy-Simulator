<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<style>
  body {
    padding: 100px;
    width: 1000px;
    margin: auto;
    text-align: left;
    font-weight: 300;
    font-family: 'Open Sans', sans-serif;
    color: #121212;
  }
  h1, h2, h3, h4 {
    font-family: 'Source Sans Pro', sans-serif;
  }
</style>
<title>CS 184 Galaxy Simulator</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link href="https://fonts.googleapis.com/css?family=Open+Sans|Source+Sans+Pro" rel="stylesheet">
</head>
<body>

<h1 align="middle">CS 184: Computer Graphics and Imaging, Spring 2019</h1>
<h1 align="middle">Final Report Webpage: Galaxy Simulator</h1>
<h2 align="middle">Jeromy Lui, Ryan Meyer, Eric Zhang</h2>

<br><br>


<h2 align="middle">Abstract</h2>

In this project, we built a simple galaxy simulator that is visually compelling. Given a certain galaxy image, we are able to initialize particles and physically simulate them. We have both CPU particles, which make up the physically simulated particles in our galaxy, and GPU particles which are used for realistic visual effects which are not part of the physical simulation. In our simulation, the GPU particles are used to mimic real phenomena such as space dust which are present in the simulation but do not affect the dynamics of the N-body system. 

<h2 align="middle">Technical Approach</h2>

<h3 align="middle">Galaxy Initialization</h3>
<h4>Position Initialization</h4>
<p>
  One unforseen challenge in the project was initializing the galaxy. While we may be able to simulate the particle's position and velocity in the next time step given the state of the galaxy in the current timestep, we need to give all the particles initial positions and velocities. In addition, although the particles don't change size, color, or mass in this version of the simulator, they still need to be initialized to some value. The challenge is to do this realistically so that it resembles a galaxy initially. The realism afterward is then left to the simulation time-stepping.
</p>
<p>
  We realized that the position of any single particle is not as important as the overall distribution of the particles. Therefore, we used a reference galaxy image as a reference for the distribution of particles from which we sampled positions. Ideally, this would be a decently high resolution image of a galaxy from a bird's eye view. Using a Python script, we segment the image into tiles and compute the average luminance of the tile, which we take as the relative density of particles in that area of the galaxy. We then normlize these densities and use them to describe a discretized probability distribution (think: buckets).
<p>
  For each particle, we sample two random variables and use the inversion method similar to what was used in importance sampling in Project 3-2 to find the corresponding tile of the original image that this particle should be spawned in. Wihtin that tile, we uniformly sample the position of the particle (indendently in each axis). The method was inspired by the importance sampling used in <a href="https://cs184.eecs.berkeley.edu/sp19/article/29/assignment-3-2,-part-3-environme">environment mapping section</a>. Again, the distribution is based off the relative luminance of the different tiles. Critical in this method is the assumption that luminance is a good estimate of the particle density of that section of the galaxy. This is works conveniently for our simulation task since in space, everything of visual significance is either emitting or reflecting light. We note that this assumption does not work well in many other types of simulation, including space simulation requiring a high degree of accuracy, as there are many things that don't emit or reflect light (eg. black holes, dark matter, etc) that would greatly affect the gravity simulations.
</p>
<p>
  We also note that with more buckets, the initial galaxy looks more realistic, as it can capture a lot of the emtpy spaces between, say, different arms of the galaxy. For regular images, using each pixel as a bucket is very reasonable, since at such scales, even a single pixel is representing a large part of the galaxy. As the number of buckets decreases (and thus the size of each bucket increases), the buckets become more conspicuous in the final simulation, as you can see the boundaries of each bucket (particles seem to form a loose rectangular prism).
</p>
<p>
  Another trick we used to get a more realistic galaxy is to increase the contrast of the galaxy image. While that makes the reference image look less aesthetically pleasing, it helps push the resulting distribution be more pronounced, encouraging particles to be spawned near the center and arms of the galaxy. The "bushiness" of the galaxy is not greatly affected since the randomness within a tile adds "bushiness".
</p>
<h4>Color Initialization</h4>
<p>
  We employed a similar approach to assign colors to each particle. Using the same image tiles as above, we calculated the color statistics on each tile. Specifically, we calculated the mean and standard deviation of the hue, saturation, and value values in each tile. When a particle was initialized in a specific tile, the hue, saturation and value of its color would be sampled from a gaussian distribution with the mean and standard deviation of that tile.
</p>
<h4>Velocity Initialization</h4>
Velocity was initialized proportional to the square root of the total mass of the galaxy and inversly proportional to the square root of the distance of the particle from the center. The reasoning behind this was purely visual, because we didn't want the particles farther away from the center, which had a weaker pull towards the center, to have too high of a velocity and thus fly out of the galaxy.



<h2 align="middle">Results</h2>

<div align="middle">
<a href="http://youtube.com">link to video (not done yet)</a>
</div>

<h2 align="middle">References</h2>

<ul>
  <li><b>Unity Game Engine</b>: we used Unity as our development platform as it has a robust rendering and physics pipeline, and has cross-platform compatibility.
    <ul>
      <li><a href="https://docs.unity3d.com/ScriptReference/">Unity API Documentation</a>
      </li>
    </ul>
    <ul>
      <li>
      <a href="https://unity.com/visual-effect-graph">Visual Effects Graph</a>: This is a new tool developed by Unity for its game engine. One of its core features is being able to render and manage a large number of particles.
      </li>
    </ul>
  </li>
  <li><a href="https://comp-astrophys-cosmol.springeropen.com/track/pdf/10.1186/s40668-017-0021-1">PKDGRAV3</a>: This research details the methods used by its authors to produce a highly performant simulation on an order of trillions of particles.
  </li>
  <li><a href="https://www.sciencedirect.com/science/article/pii/S0021999199963970">Strategies for Efficient Particle Resolution in the Direct Simulation Monte Carlo Method</a>: This paper reflects on the computational cost of Monte Carlo simulation for particle regions of varying density.
  </li>
  <li><a href="https://epubs.siam.org/doi/10.1137/0906008">An Efficient Program for Many-Body Simulation</a>: The authors of this research use a tree structure to improve the asymptotic runtime complexity of N-Body dynamics systems. This result may aid in computing gravitational forces for millions of particles in a galaxy.
  </li>
</ul>

<h2 align="middle">Contributions from each team member</h2>

<ul>
  <li>Eric Zhang
    <ul>
      <li>Created CPU and GPU particle managers and higher level functions.
      </li>
    </ul>
    <ul>
      <li>Worked on initializing particle location and color.
      </li>
    </ul>
  </li>
  <li>Ryan Meyer
  </li>
  <li>Jeromy Lui
    <ul>
      <li>Worked on python scripts to split galaxy images into grids and take various distributions based on density and color and input it into text files.
      </li>
    </ul>
     <ul>
      <li>Worked on color correction for both CPU and GPU particles.
      </li>
    </ul>
  </li>
</ul>


<h2 align="middle">End of final report webpage</h2>


<h2 align="middle">Status Report</h2>

<p>We have accomplished the foundational behavior for the camera in Unity, CPU particles (which will make up the physically simulated particles in our galaxy), and GPU particles (which will be used for realistic visual effects which are not part of the physical simulation). The CPU particles will have their positions updated by computing the dynamics of an N-body gravitational system. The GPU particles will be used to mimic real phenomena such as space dust which are present in the simulation but do not affect the dynamics of the N-body system. The preliminary results are that we are able to manage the particles and incrementally add more particles using Unity. We have plans to implement mathematical models for galaxies. One of the ideas we will be implementing is to have a galaxy model based off of the gaussian distribution on the x and z axis. Then for the y axis, we uniformly sample in the range of the guassian distribution. In terms of our progress relative to our plan, we are bit behind, as there are have been some changes to our plans. One thing we found out is that the GPU particles cannot be physically simulated, so we had to make large changes to our project. We plan to make this up by meeting up more this week for longer hours. 
</p>



<h2 align="middle">Milestone Video</h2>
<div align="middle">
<a href="https://youtu.be/lNb5_0_ISnk">link to video</a>
</div>

<h2 align="middle">Presentation Slides</h2>

<div align="middle">
<a href="https://docs.google.com/presentation/d/1xu2ZrHzIvKNY5ZIkZvRPSkFjklSIQg1v50egWpnesqE/edit?usp=sharing">link to slides</a>
</div>



</body>
</html>